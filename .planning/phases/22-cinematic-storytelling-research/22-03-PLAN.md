---
phase: 22-cinematic-storytelling-research
plan: 03
type: execute
wave: 2
depends_on: ["22-01"]
files_modified:
  - modules/AppVideoWizard/app/Livewire/VideoWizard.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Action verb library maps scene types to dynamic action verbs"
    - "Shot prompts use action verbs instead of static descriptions"
    - "Different scene moods get appropriate action verb categories"
    - "Verbs create narrative (running, reaching) not portraits (standing, wearing)"
  artifacts:
    - path: "modules/AppVideoWizard/app/Livewire/VideoWizard.php"
      provides: "ACTION_VERBS constant and getActionVerbForScene() method"
      contains: "ACTION_VERBS"
  key_links:
    - from: "getActionVerbForScene()"
      to: "buildStoryVisualContent()"
      via: "action verb injection"
      pattern: "actionVerb.*storyContent"
---

<objective>
Create an action verb library mapped to scene types/moods and integrate it into story content generation. This transforms static character descriptions into dynamic narrative moments.

Purpose: The core difference between a portrait and a cinematic frame is verbs. "A woman with dark hair" produces a portrait. "A woman reaching for the evidence" produces a story frame. By mapping scene moods to action verbs, we ensure prompts always describe characters DOING something.

Output: An `ACTION_VERBS` constant with scene-type-to-verb mappings, a `getActionVerbForScene()` method, and integration into `buildStoryVisualContent()`.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-cinematic-storytelling-research/22-RESEARCH.md
@.planning/phases/22-cinematic-storytelling-research/22-01-SUMMARY.md (if exists)

Key findings from research (Section 5.5):
```php
const ACTION_VERBS = [
    'dialogue' => ['speaking with intensity', 'gesturing emphatically', 'leaning forward', 'responding'],
    'tension' => ['recoiling', 'backing away', 'clenching fists', 'freezing in place'],
    'discovery' => ['examining closely', 'reaching toward', 'reacting to', 'uncovering'],
    'pursuit' => ['running', 'chasing', 'fleeing', 'dodging', 'sprinting'],
    'emotion' => ['breaking down', 'composing themselves', 'fighting tears', 'erupting in joy'],
    'investigation' => ['scrutinizing', 'searching', 'investigating', 'analyzing'],
];
```

Current buildStoryVisualContent() (line ~21025):
- Priority 1: Uses AI-generated shotAction if available
- Priority 2: Extracts action from narration via extractActualStoryAction()
- Priority 3: Falls back to base description

The action verb injection should happen when no strong action is already present.

Current extractActualStoryAction() (line ~21678):
- Already looks for dramatic action verbs in narration
- Has patterns for vocal, physical, movement, emotional actions
- This works well when narration has verbs - we need fallback when it doesn't
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ACTION_VERBS constant to VideoWizard.php</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add a class constant `ACTION_VERBS` near the top of the VideoWizard class, right after the GAZE_TEMPLATES constant from Plan 02 (or after other constants if Plan 02 not yet complete).

This constant maps scene moods/types to arrays of action verbs that can be used when no specific action is found in the narration.

```php
/**
 * Action verb library mapped to scene mood/type.
 *
 * When narration lacks specific action verbs, these provide dynamic alternatives
 * to static descriptions. Verbs create narrative ("running", "reaching");
 * adjectives create portraits ("wearing", "standing").
 *
 * @see 22-RESEARCH.md Section 5.5 for research background
 */
protected const ACTION_VERBS = [
    // Conversation/dialogue scenes
    'dialogue' => [
        'speaking with intensity',
        'gesturing emphatically',
        'leaning forward intently',
        'responding with visible emotion',
        'emphasizing a point',
    ],

    // Tense/suspenseful scenes
    'tension' => [
        'recoiling in shock',
        'backing away slowly',
        'clenching fists',
        'freezing in place',
        'tensing with apprehension',
    ],
    'tense' => [
        'recoiling in shock',
        'backing away slowly',
        'clenching fists',
        'freezing in place',
        'tensing with apprehension',
    ],
    'suspense' => [
        'freezing in anticipation',
        'holding breath',
        'watching intently',
        'sensing danger',
    ],

    // Discovery/investigation scenes
    'discovery' => [
        'examining closely',
        'reaching toward evidence',
        'reacting to revelation',
        'uncovering truth',
        'piecing together clues',
    ],
    'investigation' => [
        'scrutinizing details',
        'searching methodically',
        'investigating the scene',
        'analyzing evidence',
    ],
    'mystery' => [
        'studying intently',
        'noticing something odd',
        'connecting dots',
        'realizing the truth',
    ],

    // Action/pursuit scenes
    'action' => [
        'sprinting forward',
        'dodging obstacles',
        'leaping into action',
        'striking with force',
        'moving with urgency',
    ],
    'pursuit' => [
        'running at full speed',
        'chasing relentlessly',
        'fleeing desperately',
        'dodging through obstacles',
    ],

    // Emotional scenes
    'emotion' => [
        'breaking down',
        'composing themselves',
        'fighting back tears',
        'overwhelmed with feeling',
    ],
    'emotional' => [
        'breaking down',
        'composing themselves',
        'fighting back tears',
        'overwhelmed with feeling',
    ],
    'dramatic' => [
        'confronting the situation',
        'making a stand',
        'facing consequences',
        'accepting reality',
    ],
    'romantic' => [
        'gazing with affection',
        'reaching for connection',
        'leaning closer',
        'sharing an intimate moment',
    ],

    // Horror/fear scenes
    'horror' => [
        'recoiling in terror',
        'backing into corner',
        'trembling with fear',
        'frozen in horror',
    ],
    'fear' => [
        'shrinking back',
        'eyes widening in panic',
        'desperately seeking escape',
        'paralyzed by dread',
    ],

    // Comedy scenes
    'comedy' => [
        'reacting with exaggerated surprise',
        'gesturing wildly',
        'double-taking',
        'expressing disbelief',
    ],

    // Contemplative/quiet scenes
    'contemplative' => [
        'lost in thought',
        'considering deeply',
        'reflecting quietly',
        'weighing options',
    ],
    'melancholic' => [
        'staring into distance',
        'remembering the past',
        'accepting loss',
        'finding peace',
    ],

    // Default fallback
    'default' => [
        'engaged in the moment',
        'responding to the situation',
        'present in the scene',
        'moving with purpose',
    ],
];
```
  </action>
  <verify>
Search for `ACTION_VERBS` in the file - should find the constant definition.
Verify at least 15 mood categories are covered.
  </verify>
  <done>ACTION_VERBS constant exists with comprehensive mood-to-verb mappings.</done>
</task>

<task type="auto">
  <name>Task 2: Create getActionVerbForScene() method</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add a new protected method `getActionVerbForScene()` near the other prompt-building methods (after `getGazeDirectionForShot()` from Plan 02 or after `buildNegativePrompt()` from Plan 01).

This method takes scene context and returns an appropriate action verb when the narration lacks one.

```php
/**
 * Get an action verb appropriate for the scene mood/type.
 *
 * Called when extractActualStoryAction() doesn't find a strong verb in the
 * narration. Provides a dynamic fallback instead of static description.
 *
 * @param array $shotContext Scene context including mood, emotional beat
 * @param int $variationIndex Optional index for deterministic variation within a scene
 * @return string An action verb phrase
 */
protected function getActionVerbForScene(array $shotContext, int $variationIndex = 0): string
{
    // Determine scene mood from context
    $mood = strtolower($shotContext['mood'] ?? $shotContext['emotionalBeat'] ?? 'default');

    // Try exact mood match first
    if (isset(self::ACTION_VERBS[$mood])) {
        $verbs = self::ACTION_VERBS[$mood];
        return $verbs[$variationIndex % count($verbs)];
    }

    // Try partial mood matching (e.g., "tense_confrontation" -> "tense")
    foreach (self::ACTION_VERBS as $category => $verbs) {
        if (str_contains($mood, $category) || str_contains($category, $mood)) {
            return $verbs[$variationIndex % count($verbs)];
        }
    }

    // Check for emotional keywords in mood
    $emotionalKeywords = [
        'sad' => 'emotion',
        'happy' => 'emotion',
        'angry' => 'tension',
        'scared' => 'fear',
        'love' => 'romantic',
        'funny' => 'comedy',
        'dark' => 'horror',
        'quiet' => 'contemplative',
        'intense' => 'dramatic',
    ];

    foreach ($emotionalKeywords as $keyword => $category) {
        if (str_contains($mood, $keyword)) {
            $verbs = self::ACTION_VERBS[$category] ?? self::ACTION_VERBS['default'];
            return $verbs[$variationIndex % count($verbs)];
        }
    }

    // Default fallback
    $verbs = self::ACTION_VERBS['default'];
    return $verbs[$variationIndex % count($verbs)];
}
```
  </action>
  <verify>
Search for `getActionVerbForScene` in the file - should find the method definition.
Method should reference ACTION_VERBS constant and handle various mood types.
  </verify>
  <done>getActionVerbForScene() method exists and returns appropriate action verbs per scene mood.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate action verbs into enhanceStoryAction()</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Modify the `enhanceStoryAction()` method (around line 21164) to inject action verbs when the story content lacks strong verbs.

Current method adds mood descriptors. Enhance it to also add action verbs when the content is too static.

Find the current enhanceStoryAction() method and update it:

```php
/**
 * Enhance story action with emotional and visual details.
 * Adds action verbs when content is too static (portrait-like).
 */
protected function enhanceStoryAction(string $action, array $shotContext): string
{
    $enhanced = $action;

    // Check if action already has strong dynamic verbs
    $dynamicVerbs = [
        'running', 'reaching', 'turning', 'striking', 'leaping', 'dodging',
        'speaking', 'gesturing', 'examining', 'searching', 'fleeing', 'chasing',
        'breaking', 'confronting', 'recoiling', 'embracing', 'fighting',
    ];

    $hasStrongVerb = false;
    foreach ($dynamicVerbs as $verb) {
        if (stripos($enhanced, $verb) !== false) {
            $hasStrongVerb = true;
            break;
        }
    }

    // If no strong verb, inject an action verb from the library
    if (!$hasStrongVerb) {
        // Get variation index from shot position if available
        $variationIndex = $shotContext['shotIndex'] ?? 0;
        $actionVerb = $this->getActionVerbForScene($shotContext, $variationIndex);

        // Inject action verb naturally into the description
        // "Character in location" becomes "Character [action verb] in location"
        if (preg_match('/^(.+?)\s+(in|at|near|by|on|inside|outside)\s+/i', $enhanced, $matches)) {
            $subject = $matches[1];
            $preposition = $matches[2];
            $remainder = substr($enhanced, strlen($matches[0]));
            $enhanced = "{$subject}, {$actionVerb}, {$preposition} {$remainder}";
        } else {
            // Append action verb if can't inject
            $enhanced .= ", {$actionVerb}";
        }
    }

    // Add mood if available (existing behavior)
    $mood = $shotContext['mood'] ?? $shotContext['emotionalBeat'] ?? '';
    if (!empty($mood) && stripos($enhanced, $mood) === false) {
        $moodDescriptors = [
            'tense' => 'with visible tension',
            'dramatic' => 'dramatically',
            'mysterious' => 'shrouded in mystery',
            'action' => 'with dynamic intensity',
            'romantic' => 'with intimate warmth',
            'horror' => 'with creeping dread',
            'comedy' => 'with comedic timing',
        ];

        $moodDesc = $moodDescriptors[strtolower($mood)] ?? "with {$mood} atmosphere";
        $enhanced .= ", {$moodDesc}";
    }

    return $enhanced;
}
```
  </action>
  <verify>
1. Read enhanceStoryAction() method to verify action verb injection
2. Verify it calls getActionVerbForScene() when no strong verb present
3. Verify it preserves existing mood descriptor behavior
  </verify>
  <done>enhanceStoryAction() now injects action verbs for static descriptions.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. ACTION_VERBS constant exists with 15+ mood categories
2. getActionVerbForScene() method exists and uses ACTION_VERBS
3. enhanceStoryAction() calls getActionVerbForScene() for static content
4. Static descriptions get action verbs injected
5. Already-dynamic descriptions are not modified
6. No syntax errors: `php -l modules/AppVideoWizard/app/Livewire/VideoWizard.php`
</verification>

<success_criteria>
- Action verb library covers all common scene moods
- Static character descriptions receive action verb injection
- Different shots in same scene get varied actions (via variationIndex)
- Already-dynamic descriptions are preserved (no double-verbing)
- No breaking changes to existing prompt generation
</success_criteria>

<output>
After completion, create `.planning/phases/22-cinematic-storytelling-research/22-03-SUMMARY.md`
</output>
