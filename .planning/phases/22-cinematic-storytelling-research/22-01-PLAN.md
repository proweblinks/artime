---
phase: 22-cinematic-storytelling-research
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/AppVideoWizard/app/Livewire/VideoWizard.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All generated shots include anti-portrait negative prompts"
    - "Characters no longer default to looking at camera"
    - "Negative prompts are appended to user's existing negative prompts, not replacing them"
  artifacts:
    - path: "modules/AppVideoWizard/app/Livewire/VideoWizard.php"
      provides: "getAntiPortraitNegativePrompts() method and integration"
      contains: "looking at camera, looking at viewer"
  key_links:
    - from: "getAntiPortraitNegativePrompts()"
      to: "image generation calls"
      via: "negative prompt concatenation"
      pattern: "antiPortraitNegative.*negativePrompt"
---

<objective>
Add anti-portrait negative prompts to ALL shot generation to prevent AI models from defaulting to portrait-style images with characters looking at the camera.

Purpose: This is the foundational fix for the cinematic storytelling problem. Training data bias causes AI models to generate portrait-style images by default. By explicitly adding anti-portrait terms to negative prompts, we counteract this bias.

Output: A `getAntiPortraitNegativePrompts()` method that returns anti-portrait terms, integrated into all 5 image generation call sites in VideoWizard.php.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-cinematic-storytelling-research/22-RESEARCH.md

Key findings from research:
- Anti-portrait negative prompts: `looking at camera, looking at viewer, staring at viewer, eye contact, direct gaze, front-facing portrait, posed, static, stock photo`
- Must APPEND to user's negative prompts, not replace them
- All 5 image generation call sites use: `$this->storyboard['technicalSpecs']['negative']`

Current negative prompt handling (5 locations around lines 6985, 7125, 25215, 25632, 25966):
```php
$negativePrompt = null;
if (($this->storyboard['technicalSpecs']['enabled'] ?? true) &&
    !empty($this->storyboard['technicalSpecs']['negative'])) {
    $negativePrompt = $this->storyboard['technicalSpecs']['negative'];
}
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create getAntiPortraitNegativePrompts() method</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add a new protected method `getAntiPortraitNegativePrompts()` in the prompt-building section of VideoWizard.php (near line 21400, after `getDefaultLensForShot()`).

The method should:
1. Return a string of anti-portrait negative prompt terms
2. Include terms from research: `looking at camera, looking at viewer, staring at viewer, eye contact, direct gaze, front-facing portrait, posed, static, stock photo, headshot, passport photo, selfie, studio portrait, formal portrait, ID photo`
3. Have a clear docblock explaining its purpose

```php
/**
 * Get anti-portrait negative prompts to prevent AI models from generating
 * portrait-style images with characters looking at the camera.
 *
 * These terms counteract training data bias that causes models to default
 * to front-facing portraits. Applied to ALL shot generation.
 *
 * @see 22-RESEARCH.md Section 3.5 for research background
 */
protected function getAntiPortraitNegativePrompts(): string
{
    return 'looking at camera, looking at viewer, staring at viewer, ' .
        'eye contact, direct gaze, front-facing portrait, posed, static, ' .
        'stock photo, headshot, passport photo, selfie, studio portrait, ' .
        'formal portrait, ID photo';
}
```
  </action>
  <verify>
Search for `getAntiPortraitNegativePrompts` in the file to confirm method exists.
Method contains all anti-portrait terms from research.
  </verify>
  <done>Method exists with all 14 anti-portrait terms from research document.</done>
</task>

<task type="auto">
  <name>Task 2: Create buildNegativePrompt() helper method</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add a new protected method `buildNegativePrompt()` that combines user negative prompts with anti-portrait prompts. Place it right after `getAntiPortraitNegativePrompts()`.

```php
/**
 * Build the complete negative prompt by combining user's negative prompts
 * with mandatory anti-portrait prompts.
 *
 * User prompts come first (they specified them explicitly), followed by
 * anti-portrait prompts that apply to all cinematic generation.
 */
protected function buildNegativePrompt(): string
{
    $parts = [];

    // User's negative prompts first (if enabled and present)
    $techSpecsEnabled = $this->storyboard['technicalSpecs']['enabled'] ?? true;
    if ($techSpecsEnabled && !empty($this->storyboard['technicalSpecs']['negative'])) {
        $parts[] = $this->storyboard['technicalSpecs']['negative'];
    }

    // Always add anti-portrait prompts for cinematic generation
    $parts[] = $this->getAntiPortraitNegativePrompts();

    return implode(', ', array_filter($parts));
}
```
  </action>
  <verify>
Search for `buildNegativePrompt` in the file to confirm method exists.
Method combines user negative prompts with anti-portrait prompts.
  </verify>
  <done>Helper method exists that appends anti-portrait prompts to user prompts.</done>
</task>

<task type="auto">
  <name>Task 3: Update all 5 image generation call sites to use buildNegativePrompt()</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Find and update all 5 locations where negative prompts are currently built manually. Replace the pattern:

```php
// OLD PATTERN (appears ~5 times around lines 6985, 7125, 25215, 25632, 25966)
$negativePrompt = null;
if (($this->storyboard['technicalSpecs']['enabled'] ?? true) &&
    !empty($this->storyboard['technicalSpecs']['negative'])) {
    $negativePrompt = $this->storyboard['technicalSpecs']['negative'];
}
```

With:

```php
// NEW PATTERN - Always includes anti-portrait prompts
$negativePrompt = $this->buildNegativePrompt();
```

Search for `technicalSpecs']['negative']` to find all occurrences.
Each occurrence should be replaced with the single-line call to `buildNegativePrompt()`.

Important: Do NOT modify any other logic around these calls - only replace the negative prompt building.
  </action>
  <verify>
1. Search for `buildNegativePrompt()` - should appear 5 times (the calls) plus 1 time (the definition)
2. Search for the old pattern `technicalSpecs']['negative']` - should NOT appear in negative prompt building contexts
3. The method definition should still reference `technicalSpecs']['negative']` internally
  </verify>
  <done>All 5 image generation call sites now use buildNegativePrompt() which includes anti-portrait prompts.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `getAntiPortraitNegativePrompts()` method exists with 14 anti-portrait terms
2. `buildNegativePrompt()` method exists and combines user + anti-portrait prompts
3. All 5 image generation locations call `buildNegativePrompt()`
4. No syntax errors: `php -l modules/AppVideoWizard/app/Livewire/VideoWizard.php`
</verification>

<success_criteria>
- Anti-portrait negative prompts are automatically included in ALL shot generation
- User's existing negative prompts are preserved (appended to, not replaced)
- No breaking changes to existing functionality
- PHP syntax validates without errors
</success_criteria>

<output>
After completion, create `.planning/phases/22-cinematic-storytelling-research/22-01-SUMMARY.md`
</output>
