---
phase: 22-cinematic-storytelling-research
plan: 02
type: execute
wave: 2
depends_on: ["22-01"]
files_modified:
  - modules/AppVideoWizard/app/Livewire/VideoWizard.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Each shot type has a specific gaze direction template"
    - "Gaze direction is included in shot prompts where applicable"
    - "POV and establishing shots correctly have no gaze (empty template)"
    - "Shot type directive appears at START of prompt in ALL CAPS"
  artifacts:
    - path: "modules/AppVideoWizard/app/Livewire/VideoWizard.php"
      provides: "GAZE_TEMPLATES constant and getGazeDirectionForShot() method"
      contains: "GAZE_TEMPLATES"
  key_links:
    - from: "getGazeDirectionForShot()"
      to: "buildShotPrompt()"
      via: "gaze direction injection"
      pattern: "gazeDirection.*buildShotPrompt"
---

<objective>
Add shot-type-specific gaze direction templates to prompts. Different shot types require different gaze behaviors - close-ups should have intense off-screen gaze, while POV shots have no subject gaze.

Purpose: Explicit gaze direction prevents AI models from defaulting to "looking at camera" (the #1 anti-cinematic pattern). By specifying WHERE characters look for each shot type, we create narrative intention.

Output: A `GAZE_TEMPLATES` constant mapping shot types to gaze directions, a `getGazeDirectionForShot()` method, and integration into `buildShotPrompt()`.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-cinematic-storytelling-research/22-RESEARCH.md
@.planning/phases/22-cinematic-storytelling-research/22-01-SUMMARY.md (if exists, for anti-portrait context)

Key findings from research (Section 5.4):
```php
const GAZE_TEMPLATES = [
    'establishing' => '', // No gaze - environment focus
    'wide' => 'Subject looking toward [direction/object], engaged with environment',
    'medium' => 'Subject looking at [other character/object], mid-conversation/action',
    'close-up' => 'Intense expression, gaze fixed on [off-screen element]',
    'reaction' => 'Eyes directed toward [stimulus], expression changing',
    'over-shoulder' => 'Subject looking at conversation partner',
    'pov' => '', // We ARE the viewer
    'detail' => '', // Object focus
    'two-shot' => 'Characters engaged with each other, not camera',
];
```

Current buildShotPrompt() structure (line ~20965):
1. Story visual content (buildStoryVisualContent)
2. Dialogue content (buildDialogueContent)
3. Camera shot type (getBriefShotTypeInstruction) - Already ALL CAPS
4. Technical specs (buildTechnicalSpecs)

Gaze direction should be inserted between story content and dialogue content.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GAZE_TEMPLATES constant to VideoWizard.php</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add a class constant `GAZE_TEMPLATES` near the top of the VideoWizard class (after other constants, before properties). This constant maps shot types to their appropriate gaze direction templates.

```php
/**
 * Gaze direction templates for each shot type.
 * Empty string = no gaze specified (environment focus, POV, or object shots).
 *
 * These prevent AI models from defaulting to "looking at camera" by explicitly
 * specifying WHERE characters should be looking for each shot type.
 *
 * @see 22-RESEARCH.md Section 5.4 for research background
 */
protected const GAZE_TEMPLATES = [
    // Environment-focused shots - no subject gaze
    'establishing' => '',
    'extreme-wide' => '',

    // Action shots - engaged with environment
    'wide' => 'looking toward scene element, engaged with environment',
    'medium-wide' => 'looking at action or other character, not at camera',

    // Conversation shots - engaged with other characters
    'medium' => 'looking at other character or object, mid-conversation',
    'medium-close' => 'looking at conversation partner, expressive engagement',
    'over-shoulder' => 'looking at conversation partner in foreground',
    'two-shot' => 'characters engaged with each other, not looking at camera',

    // Emotional intensity shots - off-screen focus
    'close-up' => 'intense gaze fixed on off-screen element, not at camera',
    'extreme-close-up' => 'gaze directed off-screen, emotional intensity',
    'reaction' => 'eyes directed toward off-screen stimulus, expression changing',

    // Special shots - no subject or object focus
    'pov' => '', // We ARE the viewer - no subject visible
    'detail' => '', // Object focus - no character gaze
    'insert' => '', // Object focus - no character gaze

    // Angle shots - inherit from framing
    'low-angle' => 'looking ahead or at scene element, powerful presence',
    'high-angle' => 'looking down or at ground, vulnerable or thoughtful',
];
```
  </action>
  <verify>
Search for `GAZE_TEMPLATES` in the file - should find the constant definition.
Verify all 16 shot types from getBriefShotTypeInstruction() are covered.
  </verify>
  <done>GAZE_TEMPLATES constant exists with appropriate gaze directions for all shot types.</done>
</task>

<task type="auto">
  <name>Task 2: Create getGazeDirectionForShot() method</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Add a new protected method `getGazeDirectionForShot()` near the other prompt-building methods (after `buildNegativePrompt()` from Plan 01, around line 21410).

This method takes the shot type and optional context, and returns the appropriate gaze direction string.

```php
/**
 * Get gaze direction instruction for a specific shot type.
 *
 * Returns explicit gaze direction to prevent AI models from defaulting
 * to "looking at camera". Empty string for shots where gaze doesn't apply
 * (establishing, POV, detail shots).
 *
 * @param string $shotType The shot type (e.g., 'close-up', 'medium', 'pov')
 * @param array $shotContext Optional context for dynamic gaze targets
 * @return string Gaze direction instruction or empty string
 */
protected function getGazeDirectionForShot(string $shotType, array $shotContext = []): string
{
    $template = self::GAZE_TEMPLATES[$shotType] ?? '';

    // If no template or empty, return empty string (no gaze instruction)
    if (empty($template)) {
        return '';
    }

    // Enhance template with specific context if available
    $characters = $shotContext['characters'] ?? [];
    $hasMultipleCharacters = count($characters) > 1;

    // For conversation shots, specify the other character if known
    if ($hasMultipleCharacters && in_array($shotType, ['medium', 'medium-close', 'over-shoulder', 'two-shot'])) {
        // Second character is typically who the first is looking at
        $otherCharacter = $characters[1] ?? 'the other character';
        $template = str_replace('other character', $otherCharacter, $template);
        $template = str_replace('conversation partner', $otherCharacter, $template);
    }

    return $template;
}
```
  </action>
  <verify>
Search for `getGazeDirectionForShot` in the file - should find the method definition.
Method should reference GAZE_TEMPLATES constant.
  </verify>
  <done>getGazeDirectionForShot() method exists and returns appropriate gaze directions per shot type.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate gaze direction into buildShotPrompt()</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Modify the `buildShotPrompt()` method (around line 20965) to include gaze direction in the prompt.

Current structure:
```php
$promptParts = [];
$promptParts[] = $storyContent;
if (!empty($dialogueContent)) {
    $promptParts[] = $dialogueContent;
}
$promptParts[] = $cameraShot;
$promptParts[] = $technicalSpecs;
```

New structure - add gaze direction AFTER story content, BEFORE dialogue:
```php
$promptParts = [];

// Story content is ALWAYS first
$promptParts[] = $storyContent;

// Gaze direction - explicit instruction for where character looks
// This prevents AI from defaulting to "looking at camera"
$gazeDirection = $this->getGazeDirectionForShot($shotType['type'], $shotContext);
if (!empty($gazeDirection)) {
    $promptParts[] = ucfirst($gazeDirection);
}

// Add dialogue if present
if (!empty($dialogueContent)) {
    $promptParts[] = $dialogueContent;
}

// Camera shot type (brief)
$promptParts[] = $cameraShot;

// Technical specs
$promptParts[] = $technicalSpecs;
```

The gaze direction comes after story content because it modifies HOW the character appears in the story moment.
  </action>
  <verify>
1. Read buildShotPrompt() method to verify gaze direction is included
2. Verify gaze direction is added AFTER storyContent and BEFORE dialogueContent
3. Verify getGazeDirectionForShot() is called with correct parameters
  </verify>
  <done>buildShotPrompt() includes gaze direction for all shots where applicable.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. GAZE_TEMPLATES constant exists with 16+ shot type mappings
2. getGazeDirectionForShot() method exists and uses GAZE_TEMPLATES
3. buildShotPrompt() calls getGazeDirectionForShot() and includes result in prompt
4. POV/establishing shots have empty gaze (no instruction)
5. Close-up shots have "off-screen" or "not at camera" gaze
6. No syntax errors: `php -l modules/AppVideoWizard/app/Livewire/VideoWizard.php`
</verification>

<success_criteria>
- Each shot type has an appropriate gaze direction template
- Gaze direction is explicitly included in prompts (not left to AI default)
- POV and environment shots correctly have no gaze instruction
- Conversation shots reference other characters when available
- No breaking changes to existing prompt structure
</success_criteria>

<output>
After completion, create `.planning/phases/22-cinematic-storytelling-research/22-02-SUMMARY.md`
</output>
