---
phase: 09-prompts-display-copy-to-clipboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/AppVideoWizard/app/Livewire/VideoWizard.php
  - modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
autonomous: true

must_haves:
  truths:
    - "User can view full image prompt for each shot (not truncated)"
    - "User can view full video prompt for each shot (not truncated)"
    - "User can copy image prompt to clipboard with one click"
    - "User can copy video prompt to clipboard with one click"
    - "Shot type badge displays abbreviation (CU, MCU, WS, etc.)"
    - "Camera movement indicator shows with icon"
  artifacts:
    - path: "modules/AppVideoWizard/app/Livewire/VideoWizard.php"
      provides: "shots array in computed property"
      contains: "'shots' => $this->multiShotMode"
    - path: "modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php"
      provides: "Prompts section with copy buttons"
      contains: "navigator.clipboard.writeText"
  key_links:
    - from: "scene-text-inspector.blade.php"
      to: "$this->inspectorScene['shots']"
      via: "computed property access"
      pattern: "inspectorScene\\['shots'\\]"
    - from: "copy button"
      to: "clipboard API"
      via: "Alpine.js x-data with navigator.clipboard"
      pattern: "x-data.*copied.*navigator\\.clipboard"
---

<objective>
Add Prompts section to Scene Text Inspector modal with full image/video prompts and copy-to-clipboard functionality.

Purpose: Users need to view complete AI-generated prompts (currently truncated) and copy them for external use, prompt debugging, or regeneration.

Output:
- Updated computed property with shots array containing prompts
- Prompts section displaying all shots with image prompt, video prompt, type badge, camera movement
- One-click copy buttons with visual feedback for each prompt
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-prompts-display-copy-to-clipboard/09-RESEARCH.md

Key implementation details from research:
- Prompt data location: `$this->multiShotMode['decomposedScenes'][$index]['shots']`
- Each shot contains: imagePrompt, videoPrompt, type, cameraMovement
- Clipboard pattern validated in _timeline.blade.php (line 2143)
- Use json_encode() for data attributes to handle special characters
- iOS Safari fallback: execCommand('copy') in catch block
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update computed property to include shots array</name>
  <files>modules/AppVideoWizard/app/Livewire/VideoWizard.php</files>
  <action>
Update the `getInspectorSceneProperty()` computed property to include shots from decomposed scenes.

Location: Around line 1308-1318

Add this line inside the return array:
```php
'shots' => $this->multiShotMode['decomposedScenes'][$this->inspectorSceneIndex]['shots'] ?? [],
```

The full method should become:
```php
public function getInspectorSceneProperty(): ?array
{
    if ($this->inspectorSceneIndex === null) {
        return null;
    }

    return [
        'script' => $this->script['scenes'][$this->inspectorSceneIndex] ?? null,
        'storyboard' => $this->storyboard[$this->inspectorSceneIndex] ?? null,
        // Phase 9: Include shots for prompt display
        'shots' => $this->multiShotMode['decomposedScenes'][$this->inspectorSceneIndex]['shots'] ?? [],
    ];
}
```
  </action>
  <verify>
Grep for the updated property:
```bash
grep -A 10 "getInspectorSceneProperty" modules/AppVideoWizard/app/Livewire/VideoWizard.php | grep -E "shots|decomposedScenes"
```
Should show the new shots line.
  </verify>
  <done>Computed property returns shots array alongside script and storyboard data</done>
</task>

<task type="auto">
  <name>Task 2: Replace Prompts placeholder with full implementation</name>
  <files>modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php</files>
  <action>
Replace the Phase 9 placeholder (lines 293-301) with the full Prompts section implementation.

1. Add shot type abbreviation map and camera icons at the top of the @php block near line 184 (after $typeConfig):
```php
// Shot type abbreviations (PRMT-05)
$shotTypeAbbrev = [
    'extreme-wide' => 'EWS',
    'wide' => 'WS',
    'medium-wide' => 'MWS',
    'medium' => 'MS',
    'medium-close' => 'MCU',
    'close-up' => 'CU',
    'extreme-close' => 'ECU',
    'over-shoulder' => 'OTS',
    'pov' => 'POV',
    'aerial' => 'AERIAL',
];

// Camera movement icons (PRMT-06)
$cameraIcons = [
    'static' => '',
    'push-in' => 'ðŸ”',
    'pull-out' => 'ðŸ”­',
    'pan-left' => 'â¬…ï¸',
    'pan-right' => 'âž¡ï¸',
    'tilt-up' => 'â¬†ï¸',
    'tilt-down' => 'â¬‡ï¸',
    'tracking' => 'ðŸŽ¯',
    'zoom-in' => 'ðŸ”Ž',
    'zoom-out' => 'ðŸ”­',
];
```

2. Replace the Prompts section placeholder (lines 293-301) with:

```blade
{{-- Prompts Section (Phase 9) --}}
<div style="margin-bottom: 1.5rem;">
    @php
        $shots = $this->inspectorScene['shots'] ?? [];
    @endphp
    <h4 style="margin: 0 0 0.75rem 0; color: rgba(255,255,255,0.9); font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
        Prompts
        @if(!empty($shots))
            <span style="opacity: 0.6; font-weight: normal; font-size: 0.7rem; text-transform: none; margin-left: 0.5rem;">({{ count($shots) }} shots)</span>
        @endif
    </h4>

    @if(!empty($shots))
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            @foreach($shots as $shotIndex => $shot)
                @php
                    $shotType = $shot['type'] ?? 'medium';
                    $shotAbbrev = $shotTypeAbbrev[$shotType] ?? strtoupper(substr($shotType, 0, 3));
                    $cameraMove = $shot['cameraMovement'] ?? 'static';
                    $cameraIcon = $cameraIcons[$cameraMove] ?? '';
                    $imagePrompt = $shot['imagePrompt'] ?? '';
                    $videoPrompt = $shot['videoPrompt'] ?? ($shot['narrativeBeat']['motionDescription'] ?? '');
                    $imagePromptJson = json_encode($imagePrompt);
                    $videoPromptJson = json_encode($videoPrompt);
                @endphp

                <div style="padding: 0.75rem; background: rgba(139,92,246,0.08); border: 1px solid rgba(139,92,246,0.2); border-radius: 0.5rem;">
                    {{-- Shot Header with badges (PRMT-05, PRMT-06) --}}
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <span style="font-size: 0.75rem; font-weight: 600; color: white;">Shot {{ $shotIndex + 1 }}</span>

                        {{-- Shot Type Badge (PRMT-05) --}}
                        <span style="font-size: 0.6rem; font-weight: 600; color: #a5b4fc; padding: 0.15rem 0.4rem; background: rgba(99,102,241,0.3); border-radius: 0.25rem; border: 1px solid rgba(99,102,241,0.4);">
                            {{ $shotAbbrev }}
                        </span>

                        {{-- Camera Movement Indicator (PRMT-06) --}}
                        @if($cameraIcon && $cameraMove !== 'static')
                            <span style="font-size: 0.75rem;" title="{{ ucwords(str_replace('-', ' ', $cameraMove)) }}">{{ $cameraIcon }}</span>
                            <span style="font-size: 0.6rem; color: rgba(255,255,255,0.5);">{{ ucwords(str_replace('-', ' ', $cameraMove)) }}</span>
                        @endif
                    </div>

                    {{-- Image Prompt (PRMT-01, PRMT-03) --}}
                    @if($imagePrompt)
                        <div style="margin-bottom: 0.75rem;" data-prompt="{{ $imagePromptJson }}">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.35rem;">
                                <span style="font-size: 0.65rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.05em;">Image Prompt</span>
                                <button type="button"
                                        x-data="{ copied: false }"
                                        @click="
                                            const prompt = JSON.parse($el.closest('[data-prompt]').dataset.prompt);
                                            navigator.clipboard.writeText(prompt)
                                                .then(() => {
                                                    copied = true;
                                                    setTimeout(() => copied = false, 2000);
                                                })
                                                .catch(() => {
                                                    // Fallback for iOS Safari pre-16.4
                                                    const ta = document.createElement('textarea');
                                                    ta.value = prompt;
                                                    ta.style.position = 'fixed';
                                                    ta.style.opacity = '0';
                                                    document.body.appendChild(ta);
                                                    ta.select();
                                                    document.execCommand('copy');
                                                    document.body.removeChild(ta);
                                                    copied = true;
                                                    setTimeout(() => copied = false, 2000);
                                                })
                                        "
                                        style="padding: 0.2rem 0.5rem; background: rgba(139,92,246,0.2); border: 1px solid rgba(139,92,246,0.4); border-radius: 0.25rem; color: #c4b5fd; font-size: 0.6rem; cursor: pointer;">
                                    <span x-show="!copied">Copy</span>
                                    <span x-show="copied" style="color: #10b981;">Copied!</span>
                                </button>
                            </div>
                            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.85); line-height: 1.5; white-space: pre-wrap; word-break: break-word; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 0.25rem; max-height: 150px; overflow-y: auto;">
                                {{ $imagePrompt }}
                            </div>
                        </div>
                    @endif

                    {{-- Video Prompt (PRMT-02, PRMT-04) --}}
                    @if($videoPrompt)
                        <div data-prompt="{{ $videoPromptJson }}">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.35rem;">
                                <span style="font-size: 0.65rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.05em;">Video Prompt</span>
                                <button type="button"
                                        x-data="{ copied: false }"
                                        @click="
                                            const prompt = JSON.parse($el.closest('[data-prompt]').dataset.prompt);
                                            navigator.clipboard.writeText(prompt)
                                                .then(() => {
                                                    copied = true;
                                                    setTimeout(() => copied = false, 2000);
                                                })
                                                .catch(() => {
                                                    // Fallback for iOS Safari pre-16.4
                                                    const ta = document.createElement('textarea');
                                                    ta.value = prompt;
                                                    ta.style.position = 'fixed';
                                                    ta.style.opacity = '0';
                                                    document.body.appendChild(ta);
                                                    ta.select();
                                                    document.execCommand('copy');
                                                    document.body.removeChild(ta);
                                                    copied = true;
                                                    setTimeout(() => copied = false, 2000);
                                                })
                                        "
                                        style="padding: 0.2rem 0.5rem; background: rgba(139,92,246,0.2); border: 1px solid rgba(139,92,246,0.4); border-radius: 0.25rem; color: #c4b5fd; font-size: 0.6rem; cursor: pointer;">
                                    <span x-show="!copied">Copy</span>
                                    <span x-show="copied" style="color: #10b981;">Copied!</span>
                                </button>
                            </div>
                            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.85); line-height: 1.5; white-space: pre-wrap; word-break: break-word; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 0.25rem; max-height: 150px; overflow-y: auto;">
                                {{ $videoPrompt }}
                            </div>
                        </div>
                    @endif

                    {{-- No prompts for this shot --}}
                    @if(!$imagePrompt && !$videoPrompt)
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.4); font-style: italic;">
                            Prompts not generated for this shot
                        </div>
                    @endif
                </div>
            @endforeach
        </div>
    @else
        <div style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 0.5rem; text-align: center; color: rgba(255,255,255,0.4); font-size: 0.75rem;">
            {{ __('No shots decomposed for this scene') }}
        </div>
    @endif
</div>
```

Key implementation notes:
- Uses json_encode() for data-prompt attributes to handle special characters safely
- JSON.parse() in @click to recover the prompt text
- iOS Safari fallback uses execCommand('copy') with temporary textarea
- Shot type abbreviations match config.php conventions
- Camera movement icons match existing storyboard.blade.php patterns
- Falls back to narrativeBeat.motionDescription if videoPrompt is empty
- Empty state for shots without prompts (no copy button shown)
  </action>
  <verify>
1. Check prompts section exists and has copy buttons:
```bash
grep -c "navigator.clipboard.writeText" modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
```
Should return 2 (one for image prompt, one for video prompt).

2. Check shot type badges:
```bash
grep -c "shotAbbrev" modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
```
Should return at least 2.

3. Check camera icons:
```bash
grep -c "cameraIcon" modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
```
Should return at least 2.
  </verify>
  <done>
Prompts section displays:
- All shots for the scene with shot numbers
- Full image prompt with Copy button (PRMT-01, PRMT-03)
- Full video prompt with Copy button (PRMT-02, PRMT-04)
- Shot type badge abbreviation (PRMT-05)
- Camera movement indicator with icon (PRMT-06)
- Visual feedback on copy (button text changes to "Copied!")
- iOS Safari fallback for clipboard operations
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. **Computed property check:**
   ```bash
   grep -A 15 "getInspectorSceneProperty" modules/AppVideoWizard/app/Livewire/VideoWizard.php
   ```
   Should show shots array in return statement.

2. **Prompts section structure:**
   ```bash
   grep -B 2 -A 5 "Prompts Section" modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
   ```
   Should show the Phase 9 section header with shots count.

3. **Copy functionality:**
   ```bash
   grep -c "x-data.*copied" modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
   ```
   Should return 2 (one per prompt type).

4. **iOS fallback:**
   ```bash
   grep -c "execCommand" modules/AppVideoWizard/resources/views/livewire/modals/scene-text-inspector.blade.php
   ```
   Should return 2.

5. **Manual browser test:**
   - Open Video Wizard with a project that has decomposed scenes
   - Click scene card to open inspector
   - Verify Prompts section shows shots with badges
   - Click Copy button, verify "Copied!" feedback
   - Paste in external app to confirm clipboard content
</verification>

<success_criteria>
1. Modal displays complete image prompt and video prompt in separate sections with full text visible (PRMT-01, PRMT-02)
2. Each prompt section has copy button that copies text to clipboard and shows immediate visual feedback ("Copied!") (PRMT-03, PRMT-04)
3. Copy functionality works reliably across modern browsers including iOS Safari with execCommand fallback
4. Prompt sections display shot type badge (EWS, WS, MS, MCU, CU, etc.) (PRMT-05)
5. Camera movement indicator displayed with icon (PRMT-06)
6. User can copy individual prompts independently
</success_criteria>

<output>
After completion, create `.planning/phases/09-prompts-display-copy-to-clipboard/09-01-SUMMARY.md` using the summary template.

Update `.planning/STATE.md`:
- Phase 9: 100% complete
- Last activity: Phase 9 complete (6/6 PRMT requirements satisfied)
- Next: Phase 10 - Mobile Responsiveness + Polish
</output>
