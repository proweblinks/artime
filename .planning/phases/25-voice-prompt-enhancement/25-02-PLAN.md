---
phase: 25-voice-prompt-enhancement
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/AppVideoWizard/app/Services/VoicePacingService.php
  - tests/Unit/VideoWizard/VoicePacingServiceTest.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Voice prompts include pacing markers with specific timing like [PAUSE 2.5s]"
    - "Voice prompts include rate modifiers like [SLOW] and [urgent]"
    - "Pacing markers can be converted to SSML break tags for providers that support it"
  artifacts:
    - path: "modules/AppVideoWizard/app/Services/VoicePacingService.php"
      provides: "Pacing markers, timing notation, SSML conversion"
      exports: ["PAUSE_TYPES", "PACING_MODIFIERS", "insertPauseMarker", "buildPacingInstruction", "toSSML"]
    - path: "tests/Unit/VideoWizard/VoicePacingServiceTest.php"
      provides: "Unit tests for pacing service"
      min_lines: 80
  key_links:
    - from: "VoicePacingService::insertPauseMarker"
      to: "Voice prompt text"
      via: "sprintf notation"
      pattern: "\\[PAUSE.*s\\]"
---

<objective>
Create VoicePacingService with timing markers, pause notation, and rate modifiers for Hollywood-quality voice prompt pacing.

Purpose: Provides the pacing infrastructure for VOC-02 (pacing markers with timing). Supports both human-readable notation like `[PAUSE 2.5s]` and SSML-compatible `<break>` tags for providers that support them.

Output: VoicePacingService.php with constants and helper methods, plus unit tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-voice-prompt-enhancement/25-RESEARCH.md

# Pattern reference
@modules/AppVideoWizard/app/Services/TransitionVocabulary.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VoicePacingService with timing constants</name>
  <files>modules/AppVideoWizard/app/Services/VoicePacingService.php</files>
  <action>
Create VoicePacingService.php following the established service pattern.

**PAUSE_TYPES constant array (VOC-02 - named pause types):**
```php
public const PAUSE_TYPES = [
    'beat' => [
        'duration' => 0.5,
        'notation' => '[beat]',
        'ssml' => '<break time="500ms"/>',
        'description' => 'micro-pause for emphasis'
    ],
    'short' => [
        'duration' => 1.0,
        'notation' => '[short pause]',
        'ssml' => '<break time="1s"/>',
        'description' => 'brief pause for breath'
    ],
    'medium' => [
        'duration' => 2.0,
        'notation' => '[pause]',
        'ssml' => '<break time="2s"/>',
        'description' => 'standard dramatic pause'
    ],
    'long' => [
        'duration' => 3.0,
        'notation' => '[long pause]',
        'ssml' => '<break time="3s"/>',
        'description' => 'extended dramatic silence'
    ],
    'breath' => [
        'duration' => 0.3,
        'notation' => '[breath]',
        'ssml' => '<break time="300ms"/>',
        'description' => 'natural breathing pause'
    ],
];
```

**PACING_MODIFIERS constant array (rate modifiers):**
```php
public const PACING_MODIFIERS = [
    'slow' => [
        'rate_modifier' => 0.85,
        'notation' => '[SLOW]',
        'ssml_rate' => '-15%',
        'description' => 'deliberate, measured delivery'
    ],
    'measured' => [
        'rate_modifier' => 0.9,
        'notation' => '[measured]',
        'ssml_rate' => '-10%',
        'description' => 'careful, thoughtful pace'
    ],
    'normal' => [
        'rate_modifier' => 1.0,
        'notation' => '',
        'ssml_rate' => '0%',
        'description' => 'standard speaking pace'
    ],
    'urgent' => [
        'rate_modifier' => 1.1,
        'notation' => '[urgent]',
        'ssml_rate' => '+10%',
        'description' => 'pressured, time-sensitive'
    ],
    'rushed' => [
        'rate_modifier' => 1.2,
        'notation' => '[rushed]',
        'ssml_rate' => '+20%',
        'description' => 'hurried, breathless delivery'
    ],
];
```

**Helper methods:**
1. `insertPauseMarker(float $seconds): string` - Returns `[PAUSE Xs]` format, e.g., `insertPauseMarker(2.5)` returns `[PAUSE 2.5s]`
2. `getPauseNotation(string $type): string` - Returns notation for named pause type
3. `getPauseDuration(string $type): float` - Returns duration in seconds for named type
4. `getModifierNotation(string $modifier): string` - Returns notation for rate modifier
5. `toSSML(string $textWithMarkers): string` - Converts `[PAUSE Xs]` and `[beat]` etc to SSML break tags
6. `buildPacingInstruction(string $modifier, ?string $pauseBefore = null): string` - Combines modifier + optional pause: `[SLOW] [pause]`
7. `getAvailablePauseTypes(): array` - Returns all pause type keys
8. `getAvailableModifiers(): array` - Returns all modifier keys
9. `estimatePacingDuration(string $text): float` - Estimates total pause duration from markers in text

**Important constraints (from research):**
- Too many break tags cause instability; prefer punctuation for natural pauses
- Use named types (beat, short, medium, long) that adapt to context
- SSML break tags have provider-specific limits (ElevenLabs warns about instability)
  </action>
  <verify>
```bash
php -l modules/AppVideoWizard/app/Services/VoicePacingService.php
```
File has no syntax errors and contains PAUSE_TYPES and PACING_MODIFIERS constants.
  </verify>
  <done>VoicePacingService.php exists with timing constants, pause types, pacing modifiers, and SSML conversion.</done>
</task>

<task type="auto">
  <name>Task 2: Create unit tests for VoicePacingService</name>
  <files>tests/Unit/VideoWizard/VoicePacingServiceTest.php</files>
  <action>
Create comprehensive unit tests for the pacing service.

**Test cases:**
1. `test_insertPauseMarker_formats_correctly` - `insertPauseMarker(2.5)` returns `[PAUSE 2.5s]`
2. `test_insertPauseMarker_rounds_to_one_decimal` - `insertPauseMarker(2.567)` returns `[PAUSE 2.6s]`
3. `test_getPauseNotation_returns_notation_for_known_type` - `getPauseNotation('beat')` returns `[beat]`
4. `test_getPauseNotation_returns_empty_for_unknown_type` - Unknown type returns empty string
5. `test_getPauseDuration_returns_seconds` - `getPauseDuration('medium')` returns `2.0`
6. `test_getModifierNotation_returns_notation` - `getModifierNotation('slow')` returns `[SLOW]`
7. `test_getModifierNotation_normal_returns_empty` - `getModifierNotation('normal')` returns empty string
8. `test_toSSML_converts_pause_markers` - `[PAUSE 2s]` becomes `<break time="2s"/>`
9. `test_toSSML_converts_named_pauses` - `[beat]` becomes `<break time="500ms"/>`
10. `test_toSSML_preserves_text` - Text around markers is preserved
11. `test_buildPacingInstruction_combines_modifier_and_pause` - `buildPacingInstruction('slow', 'medium')` returns `[SLOW] [pause]`
12. `test_estimatePacingDuration_sums_pauses` - Text with `[pause] [beat]` returns 2.5 seconds

Run tests:
```bash
php artisan test --filter=VoicePacingServiceTest
```
  </action>
  <verify>
```bash
php artisan test --filter=VoicePacingServiceTest
```
All tests pass.
  </verify>
  <done>Unit tests verify pause marker insertion, SSML conversion, and pacing modifier functionality.</done>
</task>

</tasks>

<verification>
```bash
# Syntax check
php -l modules/AppVideoWizard/app/Services/VoicePacingService.php

# Unit tests
php artisan test --filter=VoicePacingServiceTest

# Integration check
php artisan tinker --execute="use Modules\AppVideoWizard\Services\VoicePacingService; \$p = new VoicePacingService(); echo \$p->insertPauseMarker(2.5) . ' | ' . \$p->toSSML('[PAUSE 2s] Hello [beat] world');"
```
</verification>

<success_criteria>
1. VoicePacingService.php exists with PAUSE_TYPES (5 types) and PACING_MODIFIERS (5 modifiers)
2. `insertPauseMarker(2.5)` returns `[PAUSE 2.5s]`
3. `toSSML("[PAUSE 2s] Hello")` returns `<break time="2s"/> Hello`
4. `buildPacingInstruction('slow', 'medium')` returns `[SLOW] [pause]`
5. All unit tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/25-voice-prompt-enhancement/25-02-SUMMARY.md`
</output>
