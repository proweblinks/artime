---
phase: 25-voice-prompt-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - modules/AppVideoWizard/app/Services/VoiceDirectionVocabulary.php
  - tests/Unit/VideoWizard/VoiceDirectionVocabularyTest.php
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Voice prompts include bracketed emotional direction tags like [trembling], [whisper], [voice cracks]"
    - "Voice prompts include vocal quality descriptions like gravelly, exhausted, breathless"
    - "Voice prompts include breath and non-verbal sound markers like [sighs], [gasps], [stammers]"
  artifacts:
    - path: "modules/AppVideoWizard/app/Services/VoiceDirectionVocabulary.php"
      provides: "Emotional direction vocabulary with provider-specific mappings"
      exports: ["EMOTIONAL_DIRECTION", "VOCAL_QUALITIES", "NON_VERBAL_SOUNDS", "getDirectionForEmotion", "wrapWithDirection"]
    - path: "tests/Unit/VideoWizard/VoiceDirectionVocabularyTest.php"
      provides: "Unit tests for vocabulary service"
      min_lines: 100
  key_links:
    - from: "VoiceDirectionVocabulary"
      to: "CharacterPsychologyService::EMOTION_MANIFESTATIONS"
      via: "emotion name alignment"
      pattern: "grief|anxiety|fear|contempt"
---

<objective>
Create VoiceDirectionVocabulary service with emotional direction tags, vocal quality descriptions, and non-verbal sound markers for Hollywood-quality voice prompts.

Purpose: Provides the vocabulary foundation for VOC-01 (emotional direction tags), VOC-03 (vocal quality descriptions), and VOC-05 (breath and non-verbal sounds). Follows the established vocabulary service pattern from CinematographyVocabulary and TransitionVocabulary.

Output: VoiceDirectionVocabulary.php with constants and helper methods, plus unit tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-voice-prompt-enhancement/25-RESEARCH.md

# Existing patterns to follow
@modules/AppVideoWizard/app/Services/CinematographyVocabulary.php
@modules/AppVideoWizard/app/Services/TransitionVocabulary.php
@modules/AppVideoWizard/app/Services/CharacterPsychologyService.php

# Integration points
@modules/AppVideoWizard/app/Services/SpeechSegment.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VoiceDirectionVocabulary with emotional direction constants</name>
  <files>modules/AppVideoWizard/app/Services/VoiceDirectionVocabulary.php</files>
  <action>
Create VoiceDirectionVocabulary.php following the established vocabulary service pattern.

**EMOTIONAL_DIRECTION constant array (VOC-01):**
Map emotion names to direction tags. Align with CharacterPsychologyService emotions where possible:
- `trembling`: tag `[trembling]`, elevenlabs `[nervous]`, description "voice shaking with suppressed emotion"
- `whisper`: tag `[whisper]`, elevenlabs `[whispers]`, description "hushed intimate tone"
- `cracking`: tag `[voice cracks]`, elevenlabs `[crying]`, description "emotional break mid-word"
- `grief`: tag `[grieving]`, elevenlabs `[crying]`, description "heavy with sorrow, barely held together"
- `anxiety`: tag `[anxious]`, elevenlabs `[nervous]`, description "tight, rapid, slightly higher pitch"
- `fear`: tag `[fearful]`, elevenlabs `[nervous]`, description "tremor in voice, catching breath"
- `contempt`: tag `[dismissive]`, elevenlabs `[sarcastic]`, description "cold, clipped, superior"
- `joy`: tag `[joyful]`, elevenlabs `[excited]`, description "bright, lifted, warm"

**VOCAL_QUALITIES constant array (VOC-03):**
Descriptive vocal textures (not tags, but natural language descriptions):
- `gravelly`: "rough, low texture with gravel undertone"
- `exhausted`: "drained, barely above a whisper, labored breathing"
- `breathless`: "gasping between words, urgent, out of breath"
- `steely`: "cold, controlled, emotionless precision"
- `honeyed`: "smooth, warm, persuasive sweetness"
- `raspy`: "dry, scratchy, strained throat"
- `resonant`: "deep, full, commanding presence"

**NON_VERBAL_SOUNDS constant array (VOC-05):**
Breath and non-verbal markers:
- `sigh`: tag `[sighs]`, description "audible exhale of resignation or relief"
- `gasp`: tag `[gasps]`, description "sharp inhale of surprise or shock"
- `stammer`: tag `[stammers]`, description "I-I hesitation, nervous repetition"
- `laugh`: tag `[laughs]`, description "audible laughter (match to context)"
- `sob`: tag `[sobs]`, description "crying with audible breath catching"
- `scoff`: tag `[scoffs]`, description "dismissive half-laugh exhale"
- `hesitate`: tag `[hesitates]`, description "pause with visible uncertainty"

**Helper methods:**
1. `getDirectionForEmotion(string $emotion): array` - Returns direction data for emotion, empty array if not found
2. `getVocalQuality(string $quality): string` - Returns vocal quality description
3. `getNonVerbalSound(string $sound): array` - Returns non-verbal sound data
4. `wrapWithDirection(string $text, string $emotion, string $provider = 'elevenlabs'): string` - Wraps text with provider-appropriate tags
5. `getAvailableEmotions(): array` - Returns all available emotion keys
6. `getAvailableQualities(): array` - Returns all vocal quality keys
7. `getAvailableSounds(): array` - Returns all non-verbal sound keys

**Important constraints:**
- Do NOT use FACS AU codes (research confirmed they don't work for TTS)
- Limit to 1-2 emotional tags per segment (overloading causes instability per research)
- Provider-specific tags in separate array keys, not embedded in constants
  </action>
  <verify>
```bash
php -l modules/AppVideoWizard/app/Services/VoiceDirectionVocabulary.php
```
File has no syntax errors and contains EMOTIONAL_DIRECTION, VOCAL_QUALITIES, and NON_VERBAL_SOUNDS constants.
  </verify>
  <done>VoiceDirectionVocabulary.php exists with all three constant arrays and helper methods. Can retrieve direction for emotions, wrap text with provider-specific tags.</done>
</task>

<task type="auto">
  <name>Task 2: Create unit tests for VoiceDirectionVocabulary</name>
  <files>tests/Unit/VideoWizard/VoiceDirectionVocabularyTest.php</files>
  <action>
Create comprehensive unit tests following existing test patterns.

**Test cases:**
1. `test_getDirectionForEmotion_returns_data_for_known_emotion` - Returns array with tag, elevenlabs_tag, description
2. `test_getDirectionForEmotion_returns_empty_for_unknown_emotion` - Unknown emotion returns empty array
3. `test_getVocalQuality_returns_description_for_known_quality` - Returns string description
4. `test_getVocalQuality_returns_empty_for_unknown_quality` - Unknown quality returns empty string
5. `test_getNonVerbalSound_returns_data_for_known_sound` - Returns array with tag, description
6. `test_wrapWithDirection_adds_elevenlabs_tag` - `wrapWithDirection("Hello", "grief", "elevenlabs")` returns `[crying] Hello`
7. `test_wrapWithDirection_returns_unchanged_for_openai` - OpenAI uses instructions, not inline tags
8. `test_wrapWithDirection_handles_unknown_emotion_gracefully` - Unknown emotion returns original text unchanged
9. `test_getAvailableEmotions_returns_all_emotion_keys` - Returns array including trembling, whisper, grief, anxiety, etc.
10. `test_emotion_keys_align_with_CharacterPsychologyService` - Grief, anxiety, fear, contempt exist in both services
11. `test_non_verbal_sounds_include_breath_markers` - sigh, gasp, sob exist

Run tests to verify:
```bash
php artisan test --filter=VoiceDirectionVocabularyTest
```
  </action>
  <verify>
```bash
php artisan test --filter=VoiceDirectionVocabularyTest
```
All tests pass.
  </verify>
  <done>Unit tests verify emotional direction, vocal quality, and non-verbal sound mappings work correctly. Tests for provider-specific wrapping pass.</done>
</task>

</tasks>

<verification>
```bash
# Syntax check
php -l modules/AppVideoWizard/app/Services/VoiceDirectionVocabulary.php

# Unit tests
php artisan test --filter=VoiceDirectionVocabularyTest

# Integration check - verify constants exist
php artisan tinker --execute="use Modules\AppVideoWizard\Services\VoiceDirectionVocabulary; \$v = new VoiceDirectionVocabulary(); var_dump(count(\$v::EMOTIONAL_DIRECTION), count(\$v::VOCAL_QUALITIES), count(\$v::NON_VERBAL_SOUNDS));"
```
</verification>

<success_criteria>
1. VoiceDirectionVocabulary.php exists with EMOTIONAL_DIRECTION (8+ emotions), VOCAL_QUALITIES (7+ qualities), NON_VERBAL_SOUNDS (7+ sounds)
2. `getDirectionForEmotion('grief')` returns array with tag, elevenlabs_tag, description
3. `wrapWithDirection("text", "whisper", "elevenlabs")` returns "[whispers] text"
4. All unit tests pass
5. Emotion keys align with CharacterPsychologyService (grief, anxiety, fear, contempt)
</success_criteria>

<output>
After completion, create `.planning/phases/25-voice-prompt-enhancement/25-01-SUMMARY.md`
</output>
